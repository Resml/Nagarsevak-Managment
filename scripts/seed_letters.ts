import { createClient } from '@supabase/supabase-js';
import dotenv from 'dotenv';

dotenv.config({ path: '.env' });

const supabaseUrl = process.env.VITE_SUPABASE_URL || '';
const supabaseAnonKey = process.env.VITE_SUPABASE_ANON_KEY || '';

if (!supabaseUrl || !supabaseAnonKey) {
    console.error('Missing Supabase credentials. Have you set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in .env?');
    process.exit(1);
}

const supabase = createClient(supabaseUrl, supabaseAnonKey);

const letters = [
    {
        name: 'Residence Certificate',
        name_marathi: 'रहिवासी दाखला',
        description: 'Certificate to prove local residency for banks, ration card, Aadhar, etc.',
        template_content: `विषय: श्री./श्रीमती {{name}} यांना रहिवासी दाखला मिळण्याबाबत.

प्रति, ज्यांस सादर करावयाचे त्यांस,

मी याद्वारे प्रमाणित करतो/करते की, श्री./श्रीमती {{name}}, वय {{age}}, हे गेल्या {{years_of_residency}} वर्षांपासून माझ्या निवडणूक प्रभाग क्रमांक {{ward_no}} अंतर्गत येणाऱ्या {{address}} या पत्त्यावर आपल्या कुटुंबासह कायमस्वरूपी वास्तव्यास आहेत. मी त्यांना आणि त्यांच्या कुटुंबाला वैयक्तिकरित्या तसेच सामाजिक स्तरावर गेल्या अनेक वर्षांपासून ओळखतो/ओळखते.

सदर नागरिक हे आमच्या प्रभागातील एक प्रतिष्ठित आणि जबाबदार नागरिक आहेत. त्यांना त्यांच्या वैयक्तिक कामकाजासाठी, जसे की नवीन बँक खाते उघडणे, रेशन कार्डमध्ये नाव नोंदवणे, आधार कार्ड अपडेट करणे किंवा इतर शासकीय/निमशासकीय कामांसाठी स्थानिक रहिवासी पुराव्याची आवश्यकता आहे. त्याकरिता त्यांच्या विनंतीनुसार हा दाखला देण्यात येत आहे.

मी खात्री देतो की, त्यांनी पुरवलेली माहिती माझ्या माहितीनुसार पूर्णतः सत्य आणि वस्तुस्थितीला धरून आहे. त्यांच्या उज्वल भविष्यासाठी माझ्या शुभेच्छा आहेत.`
    },
    {
        name: 'School Admission Recommendation',
        name_marathi: 'शालेय/महाविद्यालयीन प्रवेशासाठी शिफारस पत्र',
        description: 'Letter recommending a student for school or college admission.',
        template_content: `विषय: विद्यार्थ्याच्या शैक्षणिक प्रवेशासाठी विशेष शिफारस पत्र.

प्रति, मा. मुख्याध्यापक / प्राचार्य महोदय,
{{school_name}}, {{school_city}}.

महोदय/महोदया,
सप्रेम नमस्कार. मी या पत्राद्वारे आपल्या विद्यालयात शैक्षणिक प्रवेशासाठी इच्छुक असलेले विद्यार्थी/विद्यार्थिनी {{name}} यांची शिफारस करत आहे. सदर विद्यार्थी हा माझ्या प्रभागातील {{address}} येथील रहिवासी असून, अत्यंत कष्टाळू आणि शिस्तप्रिय कुटुंबातील आहे.

त्यांची मागील वर्षांची शैक्षणिक कामगिरी अत्यंत समाधानकारक असून, त्यांना शिक्षणाची तीव्र ओढ आहे. सदर विद्यार्थ्याची कौटुंबिक परिस्थिती {{financial_condition}} असून, त्यांना आपल्या सारख्या नामांकित शिक्षण संस्थेत प्रवेश मिळाल्यास त्यांच्या शैक्षणिक प्रगतीला मोठी चालना मिळेल. समाजातील गुणवंत आणि गरजू विद्यार्थ्यांना शिक्षणाच्या मुख्य प्रवाहात आणणे हे आपले सामाजिक कर्तव्य आहे.

तरी, विद्यार्थ्याची पात्रता आणि त्यांची शैक्षणिक आवड लक्षात घेऊन, आपल्या संस्थेच्या नियमावलीनुसार त्यांना {{class_or_course_name}} मध्ये प्रवेश मिळवून देण्याबाबत सकारात्मक विचार करावा, ही नम्र विनंती. याकामी आपले सहकार्य अपेक्षित आहे.`
    },
    {
        name: 'Job Recommendation Letter',
        name_marathi: 'नोकरीसाठी शिफारस पत्र',
        description: 'Recommendation letter for job application.',
        template_content: `विषय: श्री./श्रीमती {{name}} यांना नोकरीच्या संधीसाठी शिफारस.

प्रति, मा. व्यवस्थापक / विभाग प्रमुख,
{{company_name}}, {{company_address}}.

महोदय/महोदया,
मी या पत्राद्वारे श्री./श्रीमती {{name}} यांची आपल्या प्रतिष्ठित संस्थेत रिक्त असलेल्या पदासाठी शिफारस करत आहे. सदर उमेदवार माझ्या प्रभागातील {{address}} येथील रहिवासी असून, त्यांनी त्यांचे शिक्षण {{education_degree}} पूर्ण केले आहे.

मी त्यांना वैयक्तिकरित्या ओळखतो असून, ते अत्यंत प्रामाणिक, वेळेचे पालन करणारे आणि कामाप्रती समर्पित असलेले तरुण आहेत. त्यांच्याकडे संबंधित कामाचा {{experience|अनुभव असल्यास नमूद करा}} असून, नवीन गोष्टी शिकण्याची त्यांची जिद्द वाखाणण्याजोगी आहे. आपल्या संस्थेला अशा कष्टाळू आणि ध्येयवादी युवकाची साथ मिळाल्यास संस्थेच्या प्रगतीत नक्कीच भर पडेल, असा मला ठाम विश्वास आहे.

तरी, सदर उमेदवाराची शैक्षणिक पात्रता आणि त्यांची कामाची ओढ लक्षात घेऊन, त्यांना आपल्या संस्थेत काम करण्याची संधी उपलब्ध करून द्यावी, ही विनंती. त्यांच्या भविष्यातील वाटचालीस माझ्या शुभेच्छा.`
    },
    {
        name: 'Character & Identity Certificate',
        name_marathi: 'चारित्र्य व ओळखीचे प्रमाणपत्र',
        description: 'Certificate proving identity and good character.',
        template_content: `विषय: चारित्र्य आणि ओळखीचा दाखला.

प्रति, ज्यांस सादर करावयाचे त्यांस,

मी याद्वारे प्रमाणित करतो की, श्री./श्रीमती {{name}}, रा. {{address}}, हे माझ्या प्रभागातील रहिवासी असून मी त्यांना मागील {{years_known}} वर्षांपासून प्रत्यक्षपणे ओळखतो. सदर व्यक्तीचा स्वभाव मनमिळावू असून, त्यांचे चारित्र्य निष्कलंक आहे. माझ्या माहितीनुसार, त्यांच्या विरुद्ध कोणत्याही प्रकारची पोलीस तक्रार किंवा सामाजिक स्तरावर वादविवाद प्रलंबित नाहीत.

त्यांच्या सामाजिक वर्तनाबद्दल आणि नैतिकतेबद्दल परिसरात कोणतीही तक्रार नाही. हे पत्र त्यांना त्यांच्या {{reason_for_certificate}} साठी आवश्यक असल्याने देण्यात येत आहे. सदर नागरिक हे एक जबाबदार व्यक्ती असून त्यांच्या सामाजिक कार्यावर आणि वर्तणुकीवर माझा पूर्ण विश्वास आहे.

तरी, त्यांच्या या पत्राचा संबंधितांनी योग्य तो विचार करावा. हे प्रमाणपत्र केवळ त्यांच्या विनंतीवरून आणि ओळखीच्या पुराव्यासाठी दिले आहे.`
    },
    {
        name: 'Death Certificate Request',
        name_marathi: 'मृत्यू दाखला मिळण्याबाबत शिफारस',
        description: 'Recommendation to issue death certificate.',
        template_content: `विषय: कै. {{name}} यांचा मृत्यू दाखला मिळण्याबाबतची पुष्टी.

प्रति, मा. आरोग्य अधिकारी / जन्म-मृत्यू नोंदणी विभाग,
{{municipality_name}}.

महोदय,
मी या पत्राद्वारे आपणास कळवू इच्छितो की, माझ्या प्रभागातील रहिवासी श्री./श्रीमती {{name}}, वय {{age}}, रा. {{address}}, यांचे दिनांक {{date_of_death}} रोजी दुःखद निधन झाले आहे. सदर व्यक्तीचा मृत्यू {{cause_of_death}} राहत्या घरी किंवा {{hospital_name}} येथे झाला आहे.

सदर व्यक्ती आणि त्यांचे कुटुंब हे माझ्या प्रभागातील जुने रहिवासी आहेत. त्यांच्या निधनामुळे कुटुंबावर ओढवलेला प्रसंग अत्यंत दुःखद असून, पुढील विधी व कायदेशीर कामांसाठी, जसे की विमा क्लेम, वारस नोंदणी आणि मालमत्ता हस्तांतरण, त्यांना अधिकृत मृत्यू दाखल्याची तातडीने आवश्यकता आहे. त्यांच्या निधनाची नोंद आपल्या कार्यालयात करून त्यांना योग्य तो दाखला देण्यात यावा.

सदर मृत्यूची माहिती पूर्णपणे सत्य असून, कुटुंबाने पुरवलेल्या कागदपत्रांच्या आधारे मी ही शिफारस करत आहे. कृपया सहकार्य करावे.`
    },
    {
        name: 'Gas Connection Recommendation',
        name_marathi: 'नवीन गॅस कनेक्शन मिळण्यासाठी शिफारस पत्र',
        description: 'Letter recommending a new gas connection.',
        template_content: `विषय: नवीन घरगुती गॅस कनेक्शन मिळण्याबाबत शिफारस पत्र.

प्रति, मा. व्यवस्थापक/गॅस वितरक, 
{{gas_agency_name}}, {{city_name}}.

महोदय/महोदया,
सप्रेम नमस्कार. मी याद्वारे प्रमाणित करतो की, श्री./श्रीमती {{name}}, हे माझ्या निवडणूक प्रभाग क्रमांक {{ward_no}} अंतर्गत येणाऱ्या {{address}} या ठिकाणी गेल्या अनेक वर्षांपासून वास्तव्यास आहेत. सदर नागरिक हे अत्यंत गरजू कुटुंबातील असून, त्यांच्या घरात सध्या कोणतेही अधिकृत गॅस कनेक्शन उपलब्ध नाही.

त्यांना दैनंदिन स्वयंपाकासाठी आणि इंधनाच्या सोयीसाठी नवीन घरगुती गॅस कनेक्शनची तातडीने आवश्यकता आहे. मी त्यांना वैयक्तिकरित्या ओळखतो असून, त्यांच्याकडे राहण्याचा अधिकृत पुरावा म्हणून हे पत्र देण्यात येत आहे. तरी, शासनाच्या नियमांनुसार आणि आपल्या एजन्सीच्या प्रक्रियेनुसार त्यांना नवीन गॅस कनेक्शन (LPG Connection) मिळवून देण्याबाबत आवश्यक ते सहकार्य करावे, ही नम्र विनंती.

सदर पत्रासोबत त्यांनी आवश्यक असलेली कागदपत्रे जोडलेली आहेत. त्यांच्या विनंतीचा सकारात्मक विचार व्हावा ही अपेक्षा.`
    },
    {
        name: 'Income Certificate Recommendation',
        name_marathi: 'उत्पन्नाचा दाखला मिळण्याबाबत शिफारस',
        description: 'Recommendation for issuing income certificate.',
        template_content: `विषय: श्री./श्रीमती {{name}} यांच्या वार्षिक उत्पन्नाबाबत शिफारस पत्र.

प्रति, मा. तहसीलदार / सक्षम अधिकारी, 
तहसील कार्यालय, {{tehsil_name}}.

महोदय,
मी प्रमाणित करतो/करते की, श्री./श्रीमती {{name}}, रा. {{address}}, हे माझ्या प्रभागातील रहिवासी आहेत. त्यांच्या कुटुंबाची आर्थिक परिस्थिती पाहता, त्यांचे सर्व मार्गांनी मिळणारे वार्षिक उत्पन्न अंदाजे रुपये {{annual_income}}/- इतके आहे. त्यांच्या कुटुंबाचा उदरनिर्वाह प्रामुख्याने {{source_of_income}} यावर अवलंबून आहे.

सदर नागरिकाला त्यांच्या मुलांच्या शैक्षणिक शुल्कात सवलत मिळवण्यासाठी (Scholarship) किंवा इतर शासकीय योजनांचा लाभ घेण्यासाठी अधिकृत 'उत्पन्नाचा दाखला' मिळणे आवश्यक आहे. मी त्यांना आणि त्यांच्या कुटुंबाला वैयक्तिकरित्या ओळखतो असून, त्यांनी दिलेली उत्पन्नाची माहिती माझ्या माहितीनुसार सत्य आहे.

तरी, त्यांच्या कौटुंबिक परिस्थितीचा विचार करून त्यांना प्रशासकीय स्तरावर उत्पन्नाचा दाखला निर्गमित करण्यात यावा, ही शिफारस.`
    },
    {
        name: 'New Electricity Meter Recommendation',
        name_marathi: 'नवीन वीज मीटर मिळण्यासाठी शिफारस पत्र',
        description: 'Recommendation letter for new electricity meter connection.',
        template_content: `विषय: नवीन घरगुती वीज मीटर जोडणी मिळण्याबाबत शिफारस.

प्रति, मा. कनिष्ठ अभियंता / उपविभागीय अधिकारी, 
महाराष्ट्र राज्य विद्युत वितरण कंपनी (MSEDCL/महावितरण), {{mseb_branch_name}}.

महोदय,
मी याद्वारे विनंती करतो की, श्री./श्रीमती {{name}}, रा. {{address}}, हे माझ्या प्रभागातील रहिवासी असून त्यांनी त्यांच्या निवासस्थानी नवीन वीज मीटर (New Electric Connection) मिळावे यासाठी अर्ज केला आहे. सदर ठिकाणी पूर्वीची कोणतीही थकबाकी नसून, सध्या तिथे वीज पुरवठ्याची सोय नाही.

सदर घर हे अधिकृत असून नागरिक तिथे कायदेशीररीत्या वास्तव्यास आहेत. वीज ही मूलभूत गरज असल्याने त्यांना लवकरात लवकर मीटरची जोडणी मिळणे आवश्यक आहे. मी त्यांना वैयक्तिकरित्या ओळखत असून त्यांच्या विनंती अर्जाची पडताळणी करून, महावितरणच्या नियमानुसार त्यांना नवीन वीज कनेक्शन उपलब्ध करून द्यावे, ही विनंती.

याकामी आपण योग्य ती कार्यवाही करून नागरिकाला सहकार्य कराल, अशी मला खात्री आहे.`
    }
];

async function seedLetters() {
    console.log('Fetching a valid tenant_id from existing letters...');
    const { data: tenantData } = await supabase.from('letter_types').select('tenant_id').limit(1);
    const tenant_id = tenantData && tenantData[0] ? tenantData[0].tenant_id : null;

    if (!tenant_id) {
        console.error('Could not find a valid tenant_id. Cannot proceed with insertion.');
        return;
    }

    console.log(`Using tenant_id: ${tenant_id}`);
    console.log('Seeding letter types...');
    let successCount = 0;

    for (const letter of letters) {
        const payload = { ...letter, tenant_id };
        // Check if letter type already exists
        const { data: existing, error: checkError } = await supabase
            .from('letter_types')
            .select('id')
            .eq('name', letter.name)
            .single();

        if (checkError && checkError.code !== 'PGRST116') { // PGRST116 = no rows returned
            console.error(`Error checking ${letter.name}:`, checkError);
            continue;
        }

        if (existing) {
            console.log(`Skipping ${letter.name} - already exists.`);
            // Optional: Update existing
            const { error: updateError } = await supabase
                .from('letter_types')
                .update(payload)
                .eq('id', existing.id);
            if (!updateError) console.log(`Updated ${letter.name} template.`);
            continue;
        }

        const { error: insertError } = await supabase
            .from('letter_types')
            .insert([payload]);

        if (insertError) {
            console.error(`Failed to insert ${letter.name}:`, insertError);
        } else {
            console.log(`Successfully inserted ${letter.name}`);
            successCount++;
        }
    }

    console.log(`Seeding complete. Added ${successCount} new letter types.`);
}

seedLetters().catch(console.error);
