/**
 * Menu Navigator - Handles all menu navigation logic
 * No AI, pure menu-driven system
 */

const { MENUS, MESSAGES } = require('./menus');

// Session storage for each user
const userSessions = {};

// Menu states
const MENU_STATES = {
    LANGUAGE_SELECTION: 'LANGUAGE_SELECTION',
    MAIN_MENU: 'MAIN_MENU',
    COMPLAINTS_MENU: 'COMPLAINTS_MENU',
    SCHEMES_MENU: 'SCHEMES_MENU',
    VOTER_MENU: 'VOTER_MENU',
    EVENTS_MENU: 'EVENTS_MENU',
    WORKS_MENU: 'WORKS_MENU',
    WARD_PROBLEMS_MENU: 'WARD_PROBLEMS_MENU',
    CONTACT_MENU: 'CONTACT_MENU',
    OTHER_MENU: 'OTHER_MENU',
    // Complete Complaint Form states
    COMPLAINT_FORM_NAME: 'COMPLAINT_FORM_NAME',
    COMPLAINT_FORM_MOBILE: 'COMPLAINT_FORM_MOBILE',
    COMPLAINT_FORM_TYPE: 'COMPLAINT_FORM_TYPE',
    COMPLAINT_FORM_DESCRIPTION: 'COMPLAINT_FORM_DESCRIPTION',
    COMPLAINT_FORM_LOCATION: 'COMPLAINT_FORM_LOCATION',
    COMPLAINT_FORM_PHOTO: 'COMPLAINT_FORM_PHOTO',
    COMPLAINT_STATUS_MOBILE: 'COMPLAINT_STATUS_MOBILE',
    VIEW_COMPLAINTS_MOBILE: 'VIEW_COMPLAINTS_MOBILE',
    SCHEME_SEARCH_PROMPT: 'SCHEME_SEARCH_PROMPT',
    SCHEME_VIEW_MORE: 'SCHEME_VIEW_MORE',
};

class MenuNavigator {
    constructor(store) {
        this.store = store;
    }

    /**
     * Get or create user session
     */
    getSession(userId) {
        if (!userSessions[userId]) {
            userSessions[userId] = {
                language: null,
                currentMenu: MENU_STATES.LANGUAGE_SELECTION,
                previousMenu: null,
                formData: {}
            };
        }
        return userSessions[userId];
    }

    /**
     * Main message handler
     */
    async handleMessage(sock, tenantId, userId, userName, messageText) {
        const session = this.getSession(userId);
        const input = messageText.trim();

        // Check for global navigation commands
        // Check for global navigation commands
        // Exception: 0 is used to skip photo in COMPLAINT_FORM_PHOTO
        if (input === '0' && session.currentMenu !== MENU_STATES.COMPLAINT_FORM_PHOTO) {
            // Change language
            return await this.showLanguageMenu(sock, userId);
        }

        if (input === '9' && session.currentMenu !== MENU_STATES.MAIN_MENU) {
            // Go back to main menu
            return await this.showMainMenu(sock, userId, session.language);
        }

        // Route to appropriate handler based on current state
        switch (session.currentMenu) {
            case MENU_STATES.LANGUAGE_SELECTION:
                return await this.handleLanguageSelection(sock, userId, userName, input);

            case MENU_STATES.MAIN_MENU:
                return await this.handleMainMenu(sock, tenantId, userId, input);

            case MENU_STATES.COMPLAINTS_MENU:
                return await this.handleComplaintsMenu(sock, tenantId, userId, input);

            case MENU_STATES.SCHEMES_MENU:
                return await this.handleSchemesMenu(sock, tenantId, userId, input);

            case MENU_STATES.VOTER_MENU:
                return await this.handleVoterMenu(sock, tenantId, userId, input);

            case MENU_STATES.EVENTS_MENU:
                return await this.handleEventsMenu(sock, tenantId, userId, input);

            case MENU_STATES.WORKS_MENU:
                return await this.handleWorksMenu(sock, tenantId, userId, input);

            case MENU_STATES.WARD_PROBLEMS_MENU:
                return await this.handleWardProblemsMenu(sock, tenantId, userId, input);

            case MENU_STATES.CONTACT_MENU:
                return await this.handleContactMenu(sock, tenantId, userId, input);

            case MENU_STATES.OTHER_MENU:
                return await this.handleOtherMenu(sock, tenantId, userId, input);

            // Form states
            case MENU_STATES.COMPLAINT_FORM_NAME:
                return await this.handleComplaintFormName(sock, tenantId, userId, input);

            case MENU_STATES.COMPLAINT_FORM_MOBILE:
                return await this.handleComplaintFormMobile(sock, tenantId, userId, input);

            case MENU_STATES.COMPLAINT_FORM_TYPE:
                return await this.handleComplaintFormType(sock, tenantId, userId, input);

            case MENU_STATES.COMPLAINT_FORM_DESCRIPTION:
                return await this.handleComplaintFormDescription(sock, tenantId, userId, input);

            case MENU_STATES.COMPLAINT_FORM_LOCATION:
                return await this.handleComplaintFormLocation(sock, tenantId, userId, input);

            case MENU_STATES.COMPLAINT_FORM_PHOTO:
                return await this.handleComplaintFormPhoto(sock, tenantId, userId, input);

            case 'VOTER_SEARCH_PROMPT':
                return await this.handleVoterSearch(sock, tenantId, userId, input);

            case MENU_STATES.COMPLAINT_STATUS_MOBILE:
                return await this.handleComplaintStatusMobile(sock, tenantId, userId, input);

            case MENU_STATES.VIEW_COMPLAINTS_MOBILE:
                return await this.handleViewComplaintsMobile(sock, tenantId, userId, input);

            case MENU_STATES.SCHEME_SEARCH_PROMPT:
                return await this.handleSchemeSearch(sock, tenantId, userId, input);

            case MENU_STATES.SCHEME_VIEW_MORE:
                return await this.handleSchemeViewMore(sock, tenantId, userId, input);

            default:
                // Fallback to language selection
                return await this.showLanguageMenu(sock, userId);
        }
    }

    /**
     * Show language selection menu
     */
    async showLanguageMenu(sock, userId) {
        const session = this.getSession(userId);
        session.currentMenu = MENU_STATES.LANGUAGE_SELECTION;
        session.previousMenu = null;

        // Send multi-language welcome message
        const welcomeText = MENUS.language.en.text;
        await sock.sendMessage(userId, { text: welcomeText });
    }

    /**
     * Handle language selection
     */
    async handleLanguageSelection(sock, userId, userName, input) {
        const session = this.getSession(userId);
        let selectedLanguage = null;

        // Map input to language
        if (input === '1' || input.toLowerCase().includes('english')) {
            selectedLanguage = 'en';
        } else if (input === '2' || input.includes('‡§Æ‡§∞‡§æ‡§†‡•Ä')) {
            selectedLanguage = 'mr';
        } else if (input === '3' || input.includes('‡§π‡§ø‡§Ç‡§¶‡•Ä')) {
            selectedLanguage = 'hi';
        }

        if (selectedLanguage) {
            // Save language
            session.language = selectedLanguage;
            await this.store.saveUser(userId, { language: selectedLanguage, name: userName });

            // Send confirmation
            const confirmMsg = MESSAGES.language_selected[selectedLanguage];
            await sock.sendMessage(userId, { text: confirmMsg });

            // Show main menu
            return await this.showMainMenu(sock, userId, selectedLanguage);
        } else {
            // Invalid selection, show menu again
            const errorMsg = MESSAGES.invalid_option.en + '\n\n' + MENUS.language.en.text;
            await sock.sendMessage(userId, { text: errorMsg });
        }
    }

    /**
     * Show main menu
     */
    async showMainMenu(sock, userId, language) {
        const session = this.getSession(userId);
        session.currentMenu = MENU_STATES.MAIN_MENU;
        session.previousMenu = null;

        const menuText = MENUS.main[language].text;
        await sock.sendMessage(userId, { text: menuText });
    }

    /**
     * Handle main menu selection
     */
    async handleMainMenu(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        switch (input) {
            case '1':
                return await this.showComplaintsMenu(sock, userId, lang);
            case '2':
                return await this.showSchemesMenu(sock, userId, lang);
            case '3':
                return await this.showVoterMenu(sock, userId, lang);
            case '4':
                return await this.showEventsMenu(sock, userId, lang);
            case '5':
                return await this.showWorksMenu(sock, userId, lang);
            case '6':
                return await this.showWardProblemsMenu(sock, userId, lang);
            case '7':
                return await this.showContactMenu(sock, userId, lang);
            case '8':
                return await this.showOtherMenu(sock, userId, lang);
            default:
                // Invalid option
                const errorMsg = MESSAGES.invalid_option[lang] + '\n\n' + MENUS.main[lang].text;
                await sock.sendMessage(userId, { text: errorMsg });
        }
    }

    /**
     * Complaints Menu
     */
    async showComplaintsMenu(sock, userId, lang) {
        const session = this.getSession(userId);
        session.currentMenu = MENU_STATES.COMPLAINTS_MENU;
        session.previousMenu = MENU_STATES.MAIN_MENU;

        await sock.sendMessage(userId, { text: MENUS.complaints[lang].text });
    }

    async handleComplaintsMenu(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        switch (input) {
            case '1':
                // Submit new complaint - start form
                session.currentMenu = MENU_STATES.COMPLAINT_FORM_NAME;
                session.formData = {};
                await sock.sendMessage(userId, { text: MESSAGES.complaint_name_prompt[lang] });
                break;
            case '2':
                // Check complaint status
                session.currentMenu = MENU_STATES.COMPLAINT_STATUS_MOBILE;
                const statusMsg = lang === 'en' ? 'üì± Please enter your mobile number to check complaint status:' :
                    lang === 'mr' ? 'üì± ‡§§‡§ï‡•ç‡§∞‡§æ‡§∞ ‡§∏‡•ç‡§•‡§ø‡§§‡•Ä ‡§§‡§™‡§æ‡§∏‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ï‡•É‡§™‡§Ø‡§æ ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ:' :
                        'üì± ‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§ ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ú‡§æ‡§Ç‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç:';
                await sock.sendMessage(userId, { text: statusMsg });
                break;
            case '3':
                // View my complaints
                session.currentMenu = MENU_STATES.VIEW_COMPLAINTS_MOBILE;
                const viewMsg = lang === 'en' ? 'üì± Please enter your mobile number to view your complaints:' :
                    lang === 'mr' ? 'üì± ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§§‡§ï‡•ç‡§∞‡§æ‡§∞‡•Ä ‡§™‡§æ‡§π‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ï‡•É‡§™‡§Ø‡§æ ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ:' :
                        'üì± ‡§Ö‡§™‡§®‡•Ä ‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§‡•á‡§Ç ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç:';
                await sock.sendMessage(userId, { text: viewMsg });
                break;
            default:
                const errorMsg = MESSAGES.invalid_option[lang] + '\n\n' + MENUS.complaints[lang].text;
                await sock.sendMessage(userId, { text: errorMsg });
        }
    }

    /**
     * Complaint Form Handlers (Complete Multi-Step Form)
     */
    async handleComplaintFormName(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        session.formData.name = input;
        session.currentMenu = MENU_STATES.COMPLAINT_FORM_MOBILE;

        const lang = session.language;
        await sock.sendMessage(userId, { text: MESSAGES.complaint_mobile_prompt[lang] });
    }

    async handleComplaintFormMobile(sock, tenantId, userId, input) {
        const session = this.getSession(userId);

        // Simple validation: must be 10 digits
        const cleanMobile = input.replace(/\D/g, '');
        if (cleanMobile.length !== 10) {
            const lang = session.language;
            const errorMsg = lang === 'en' ? '‚ùå Please enter a valid 10-digit mobile number' :
                lang === 'mr' ? '‚ùå ‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡•à‡§ß ‡•ß‡•¶ ‡§Ö‡§Ç‡§ï‡•Ä ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ' :
                    '‚ùå ‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§µ‡•à‡§ß 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç';
            await sock.sendMessage(userId, { text: errorMsg + '\n\n' + MESSAGES.complaint_mobile_prompt[lang] });
            return;
        }

        session.formData.mobile = cleanMobile;
        session.currentMenu = MENU_STATES.COMPLAINT_FORM_TYPE;

        const lang = session.language;
        await sock.sendMessage(userId, { text: MESSAGES.complaint_type_prompt[lang] });
    }

    async handleComplaintFormType(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        // Map complaint types
        const typeMap = {
            '1': { en: 'Road', mr: '‡§∞‡§∏‡•ç‡§§‡•á', hi: '‡§∏‡§°‡§º‡§ï‡•á‡§Ç', db: 'Road' },
            '2': { en: 'Water', mr: '‡§™‡§æ‡§£‡•Ä‡§™‡•Å‡§∞‡§µ‡§†‡§æ', hi: '‡§™‡§æ‡§®‡•Ä ‡§ï‡•Ä ‡§Ü‡§™‡•Ç‡§∞‡•ç‡§§‡§ø', db: 'Water' },
            '3': { en: 'Electricity', mr: '‡§µ‡•Ä‡§ú‡§™‡•Å‡§∞‡§µ‡§†‡§æ', hi: '‡§¨‡§ø‡§ú‡§≤‡•Ä', db: 'StreetLight' },
            '4': { en: 'Waste', mr: '‡§ï‡§ö‡§∞‡§æ/‡§∏‡•ç‡§µ‡§ö‡•ç‡§õ‡§§‡§æ', hi: '‡§ï‡§ö‡§∞‡§æ/‡§∏‡§´‡§æ‡§à', db: 'Cleaning' },
            '5': { en: 'Street Lights', mr: '‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä‡§ü ‡§≤‡§æ‡§á‡§ü', hi: '‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä‡§ü ‡§≤‡§æ‡§á‡§ü', db: 'StreetLight' },
            '6': { en: 'Drainage', mr: '‡§ó‡§ü‡§æ‡§∞/‡§°‡•ç‡§∞‡•á‡§®‡•á‡§ú', hi: '‡§®‡§æ‡§≤‡•Ä/‡§°‡•ç‡§∞‡•á‡§®‡•á‡§ú', db: 'Drainage' },
            '7': { en: 'Other', mr: '‡§á‡§§‡§∞', hi: '‡§Ö‡§®‡•ç‡§Ø', db: 'Other' }
        };

        if (!typeMap[input]) {
            await sock.sendMessage(userId, { text: MESSAGES.invalid_option[lang] + '\n\n' + MESSAGES.complaint_type_prompt[lang] });
            return;
        }

        session.formData.type = typeMap[input].db;
        session.formData.typeDisplay = typeMap[input][lang];
        session.currentMenu = MENU_STATES.COMPLAINT_FORM_DESCRIPTION;

        await sock.sendMessage(userId, { text: MESSAGES.complaint_description_prompt[lang] });
    }

    async handleComplaintFormDescription(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        session.formData.description = input;
        session.currentMenu = MENU_STATES.COMPLAINT_FORM_LOCATION;

        const lang = session.language;
        await sock.sendMessage(userId, { text: MESSAGES.complaint_location_prompt[lang] });
    }

    async handleComplaintFormLocation(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        session.formData.location = input;
        session.currentMenu = MENU_STATES.COMPLAINT_FORM_PHOTO;

        const lang = session.language;
        await sock.sendMessage(userId, { text: MESSAGES.complaint_photo_prompt[lang] });
    }

    async handleComplaintFormPhoto(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;
        const cleanInput = input.trim();

        console.log(`[DEBUG] handleComplaintFormPhoto input: '${input}', clean: '${cleanInput}'`);

        // Check if user wants to skip photo
        if (cleanInput === '0' || cleanInput.toLowerCase() === 'skip') {
            // No photo, proceed to save
            console.log('[DEBUG] Skipping photo, saving complaint...');
            return await this.saveComplaint(sock, tenantId, userId);
        }

        // TODO: Handle actual photo message
        // For now, just skip if it's not 0, but ideally we should handle image messages
        // If it's text but not '0', we might want to say "Please send photo or 0 to skip"
        // But for now let's be permissive and just save
        console.log('[DEBUG] Input received (not 0), proceeding to save...');
        return await this.saveComplaint(sock, tenantId, userId);
    }

    async saveComplaint(sock, tenantId, userId) {
        const session = this.getSession(userId);
        const lang = session.language;

        try {
            // Prepare complaint data
            const complaint = {
                user_name: session.formData.name,
                user_id: userId,
                mobile: session.formData.mobile,
                title: `${session.formData.typeDisplay} - ${session.formData.location}`,
                description: session.formData.description,
                type: session.formData.type,
                area: session.formData.location,
                location: session.formData.location,
                status: 'Pending',
                source: 'WhatsApp',
                urgency: 'Medium',
                photos: [],
                tenantId: tenantId
            };

            // Save to database
            const result = await this.store.saveComplaint(complaint);

            // Get the complaint ID from result
            const complaintId = result?.id || 'XXXX';

            // Send success message with ID
            const successMsg = MESSAGES.complaint_registered[lang].replace('#{id}', complaintId);
            await sock.sendMessage(userId, { text: successMsg });

            // Reset form data and return to main menu
            session.formData = {};
            return await this.showMainMenu(sock, userId, lang);

        } catch (error) {
            console.error('Error saving complaint:', error);
            const errorMsg = lang === 'en' ? '‚ùå Sorry, there was an error saving your complaint. Please try again later.' :
                lang === 'mr' ? '‚ùå ‡§Æ‡§æ‡§´ ‡§ï‡§∞‡§æ, ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§§‡§ï‡•ç‡§∞‡§æ‡§∞ ‡§ú‡§§‡§® ‡§ï‡§∞‡§§‡§æ‡§®‡§æ ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä ‡§Ü‡§≤‡•Ä. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ.' :
                    '‚ùå ‡§ï‡•ç‡§∑‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç, ‡§Ü‡§™‡§ï‡•Ä ‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§ ‡§∏‡§π‡•á‡§ú‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§';
            await sock.sendMessage(userId, { text: errorMsg });

            // Reset and show main menu
            session.formData = {};
            return await this.showMainMenu(sock, userId, lang);
        }
    }

    async handleComplaintStatusMobile(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;
        const mobile = input.trim();

        // Validate mobile number
        if (!/^\d{10}$/.test(mobile.replace(/\D/g, ''))) {
            const invalidMsg = lang === 'en' ? '‚ùå Invalid mobile number. Please enter a 10-digit number:' :
                lang === 'mr' ? '‚ùå ‡§Ö‡§µ‡•à‡§ß ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞. ‡§ï‡•É‡§™‡§Ø‡§æ 10 ‡§Ö‡§Ç‡§ï‡•Ä ‡§®‡§Ç‡§¨‡§∞ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ:' :
                    '‚ùå ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç:';
            await sock.sendMessage(userId, { text: invalidMsg });
            return;
        }

        const complaints = await this.store.getComplaintsByMobile(tenantId, mobile);

        if (!complaints || complaints.length === 0) {
            const noComplaints = lang === 'en' ? '‚ùå No complaints found for this mobile number.' :
                lang === 'mr' ? '‚ùå ‡§Ø‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞‡§∏‡§æ‡§†‡•Ä ‡§ï‡•ã‡§£‡§§‡•ç‡§Ø‡§æ‡§π‡•Ä ‡§§‡§ï‡•ç‡§∞‡§æ‡§∞‡•Ä ‡§∏‡§æ‡§™‡§°‡§≤‡•ç‡§Ø‡§æ ‡§®‡§æ‡§π‡•Ä‡§§.' :
                    '‚ùå ‡§á‡§∏ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§';
            await sock.sendMessage(userId, { text: noComplaints });
        } else {
            const complaint = complaints[0];
            const statusEmoji = complaint.status === 'Resolved' ? '‚úÖ' : complaint.status === 'In Progress' ? '‚è≥' : 'üî¥';
            const statusText = lang === 'en' ?
                `${statusEmoji} *Complaint Status*

Complaint ID: #${complaint.id}
Status: ${complaint.status}
Category: ${complaint.category}
Priority: ${complaint.priority}

Problem: ${complaint.problem}

_Latest complaint shown. Total: ${complaints.length}_` :
                lang === 'mr' ?
                    `${statusEmoji} *‡§§‡§ï‡•ç‡§∞‡§æ‡§∞ ‡§∏‡•ç‡§•‡§ø‡§§‡•Ä*

‡§§‡§ï‡•ç‡§∞‡§æ‡§∞ ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: #${complaint.id}
‡§∏‡•ç‡§•‡§ø‡§§‡•Ä: ${complaint.status}
‡§™‡•ç‡§∞‡§ï‡§æ‡§∞: ${complaint.category}
‡§™‡•ç‡§∞‡§æ‡§ß‡§æ‡§®‡•ç‡§Ø: ${complaint.priority}

‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ: ${complaint.problem}

_‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§§‡§ï‡•ç‡§∞‡§æ‡§∞ ‡§¶‡§∞‡•ç‡§∂‡§µ‡§ø‡§≤‡•Ä. ‡§è‡§ï‡•Ç‡§£: ${complaints.length}_` :
                    `${statusEmoji} *‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø*

‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§ ID: #${complaint.id}
‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ${complaint.status}
‡§∂‡•ç‡§∞‡•á‡§£‡•Ä: ${complaint.category}
‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ: ${complaint.priority}

‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ: ${complaint.problem}

_‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§ ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§ó‡§à‡•§ ‡§ï‡•Å‡§≤: ${complaints.length}_`;
            await sock.sendMessage(userId, { text: statusText });
        }

        session.currentMenu = MENU_STATES.COMPLAINTS_MENU;
        await this.showComplaintsMenu(sock, userId, lang);
    }

    async handleViewComplaintsMobile(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;
        const mobile = input.trim();

        // Validate mobile number
        if (!/^\d{10}$/.test(mobile.replace(/\D/g, ''))) {
            const invalidMsg = lang === 'en' ? '‚ùå Invalid mobile number. Please enter a 10-digit number:' :
                lang === 'mr' ? '‚ùå ‡§Ö‡§µ‡•à‡§ß ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞. ‡§ï‡•É‡§™‡§Ø‡§æ 10 ‡§Ö‡§Ç‡§ï‡•Ä ‡§®‡§Ç‡§¨‡§∞ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ:' :
                    '‚ùå ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç:';
            await sock.sendMessage(userId, { text: invalidMsg });
            return;
        }

        const complaints = await this.store.getComplaintsByMobile(tenantId, mobile);

        if (!complaints || complaints.length === 0) {
            const noComplaints = lang === 'en' ? '‚ùå No complaints found for this mobile number.' :
                lang === 'mr' ? '‚ùå ‡§Ø‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞‡§∏‡§æ‡§†‡•Ä ‡§ï‡•ã‡§£‡§§‡•ç‡§Ø‡§æ‡§π‡•Ä ‡§§‡§ï‡•ç‡§∞‡§æ‡§∞‡•Ä ‡§∏‡§æ‡§™‡§°‡§≤‡•ç‡§Ø‡§æ ‡§®‡§æ‡§π‡•Ä‡§§.' :
                    '‚ùå ‡§á‡§∏ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§';
            await sock.sendMessage(userId, { text: noComplaints });
        } else {
            let listText = lang === 'en' ? `üìã *Your Complaints* (${complaints.length})

` :
                lang === 'mr' ? `üìã *‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§§‡§ï‡•ç‡§∞‡§æ‡§∞‡•Ä* (${complaints.length})

` :
                    `üìã *‡§Ü‡§™‡§ï‡•Ä ‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§‡•á‡§Ç* (${complaints.length})

`;

            complaints.forEach((complaint, index) => {
                const statusEmoji = complaint.status === 'Resolved' ? '‚úÖ' : complaint.status === 'In Progress' ? '‚è≥' : 'üî¥';
                const date = new Date(complaint.created_at).toLocaleDateString(lang === 'mr' ? 'mr-IN' : lang === 'hi' ? 'hi-IN' : 'en-IN');

                listText += lang === 'en' ?
                    `${index + 1}. ${statusEmoji} ID: #${complaint.id}
   ${complaint.category} - ${complaint.status}
   ${date}

` :
                    lang === 'mr' ?
                        `${index + 1}. ${statusEmoji} ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: #${complaint.id}
   ${complaint.category} - ${complaint.status}
   ${date}

` :
                        `${index + 1}. ${statusEmoji} ID: #${complaint.id}
   ${complaint.category} - ${complaint.status}
   ${date}

`;
            });

            await sock.sendMessage(userId, { text: listText });
        }

        session.currentMenu = MENU_STATES.COMPLAINTS_MENU;
        await this.showComplaintsMenu(sock, userId, lang);
    }

    /**
     * Schemes Menu
     */
    async showSchemesMenu(sock, userId, lang) {
        const session = this.getSession(userId);
        session.currentMenu = MENU_STATES.SCHEMES_MENU;
        session.previousMenu = MENU_STATES.MAIN_MENU;

        await sock.sendMessage(userId, { text: MENUS.schemes[lang].text });
    }

    async handleSchemesMenu(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        switch (input) {
            case '1': // View All Schemes
                session.schemeOffset = 0; // Reset offset
                const schemes = await this.store.getSchemes(tenantId, { limit: 10, offset: 0 });
                if (!schemes || schemes.length === 0) {
                    const noSchemes = lang === 'en' ? 'No schemes available at the moment.' :
                        lang === 'mr' ? '‡§∏‡§ß‡•ç‡§Ø‡§æ ‡§ï‡•ã‡§£‡§§‡•ç‡§Ø‡§æ‡§π‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä‡§§.' : '‡§´‡§ø‡§≤‡§π‡§æ‡§≤ ‡§ï‡•ã‡§à ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§';
                    await sock.sendMessage(userId, { text: noSchemes });
                } else {
                    await this.displaySchemes(sock, userId, schemes, lang, 0);

                    // Check if there are more schemes
                    const moreSchemes = await this.store.getSchemes(tenantId, { limit: 1, offset: 10 });
                    if (moreSchemes && moreSchemes.length > 0) {
                        const moreMsg = lang === 'en' ? '\nüìÑ Send *MORE* to see more schemes or press 9 for menu' :
                            lang === 'mr' ? '\nüìÑ ‡§Ö‡§ß‡§ø‡§ï ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§™‡§æ‡§π‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä *MORE* ‡§™‡§æ‡§†‡§µ‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§Æ‡•á‡§®‡•Ç‡§∏‡§æ‡§†‡•Ä 9 ‡§¶‡§æ‡§¨‡§æ' :
                                '\nüìÑ ‡§Ö‡§ß‡§ø‡§ï ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è *MORE* ‡§≠‡•á‡§ú‡•á‡§Ç ‡§Ø‡§æ ‡§Æ‡•á‡§®‡•Ç ‡§ï‡•á ‡§≤‡§ø‡§è 9 ‡§¶‡§¨‡§æ‡§è‡§Ç';
                        await sock.sendMessage(userId, { text: moreMsg });
                        session.currentMenu = MENU_STATES.SCHEME_VIEW_MORE;
                        session.schemeOffset = 10;
                        return; // Don't show menu again yet
                    }
                }
                await this.showSchemesMenu(sock, userId, lang);
                break;

            case '2': // Search Scheme
                session.currentMenu = MENU_STATES.SCHEME_SEARCH_PROMPT;
                const searchMsg = lang === 'en' ? 'üîç Enter scheme name or keyword to search:' :
                    lang === 'mr' ? 'üîç ‡§∂‡•ã‡§ß ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§Ø‡•ã‡§ú‡§®‡•á‡§ö‡•á ‡§®‡§æ‡§µ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∂‡§¨‡•ç‡§¶ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ:' :
                        'üîç ‡§ñ‡•ã‡§ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§Ø‡§æ ‡§ï‡•Ä‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç:';
                await sock.sendMessage(userId, { text: searchMsg });
                break;

            case '3': // Schemes For Me (Basic - show all for now)
                const personalizedMsg = lang === 'en' ?
                    `üë§ *Personalized Recommendations*

Showing all available schemes. Please check eligibility for each scheme:
` :
                    lang === 'mr' ?
                        `üë§ *‡§µ‡•à‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï ‡§∂‡§ø‡§´‡§æ‡§∞‡§∏‡•Ä*

‡§∏‡§∞‡•ç‡§µ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¶‡§∞‡•ç‡§∂‡§µ‡§ø‡§≤‡•ç‡§Ø‡§æ ‡§ú‡§æ‡§§ ‡§Ü‡§π‡•á‡§§. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§Ø‡•ã‡§ú‡§®‡•á‡§∏‡§æ‡§†‡•Ä ‡§™‡§æ‡§§‡•ç‡§∞‡§§‡§æ ‡§§‡§™‡§æ‡§∏‡§æ:
` :
                        `üë§ *‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂‡•á‡§Ç*

‡§∏‡§≠‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§ú‡§æ ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡§æ‡§§‡•ç‡§∞‡§§‡§æ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç:
`;
                await sock.sendMessage(userId, { text: personalizedMsg });

                const allSchemes = await this.store.getSchemes(tenantId, { limit: 10, offset: 0 });
                if (allSchemes && allSchemes.length > 0) {
                    await this.displaySchemes(sock, userId, allSchemes, lang, 0);
                }
                await this.showSchemesMenu(sock, userId, lang);
                break;

            case '4': // How to Apply
                const applyGuide = lang === 'en' ?
                    `üìù *How to Apply for Schemes*

1Ô∏è‚É£ *Check Eligibility*
   Read scheme details carefully and verify you meet all criteria

2Ô∏è‚É£ *Prepare Documents*
   Gather required documents (usually Aadhar, Income Certificate, etc.)

3Ô∏è‚É£ *Visit Office or Apply Online*
   ‚Ä¢ Visit our office during working hours
   ‚Ä¢ Or check if online application is available
   ‚Ä¢ Call for more details: See Contact section

4Ô∏è‚É£ *Submit Application*
   Fill form completely with correct details

5Ô∏è‚É£ *Follow Up*
   Track your application status
   Contact office if needed

üí° *Tip*: Keep photocopies of all documents` :
                    lang === 'mr' ?
                        `üìù *‡§Ø‡•ã‡§ú‡§®‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä ‡§Ö‡§∞‡•ç‡§ú ‡§ï‡§∏‡§æ ‡§ï‡§∞‡§æ‡§µ‡§æ*

1Ô∏è‚É£ *‡§™‡§æ‡§§‡•ç‡§∞‡§§‡§æ ‡§§‡§™‡§æ‡§∏‡§æ*
   ‡§Ø‡•ã‡§ú‡§®‡•á‡§ö‡•á ‡§§‡§™‡§∂‡•Ä‡§≤ ‡§ï‡§æ‡§≥‡§ú‡•Ä‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§µ‡§æ‡§ö‡§æ ‡§Ü‡§£‡§ø ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§∏‡§∞‡•ç‡§µ ‡§®‡§ø‡§ï‡§∑‡§æ‡§Ç‡§ö‡•Ä ‡§™‡•Ç‡§∞‡•ç‡§§‡§§‡§æ ‡§ï‡§∞‡§§‡§æ ‡§Ø‡§æ‡§ö‡•Ä ‡§™‡§°‡§§‡§æ‡§≥‡§£‡•Ä ‡§ï‡§∞‡§æ

2Ô∏è‚É£ *‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡•á ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ*
   ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡•á ‡§ó‡•ã‡§≥‡§æ ‡§ï‡§∞‡§æ (‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø‡§§‡§É ‡§Ü‡§ß‡§æ‡§∞, ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞ ‡§á.)

3Ô∏è‚É£ *‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø‡§æ‡§§ ‡§≠‡•á‡§ü ‡§¶‡•ç‡§Ø‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§Ö‡§∞‡•ç‡§ú ‡§ï‡§∞‡§æ*
   ‚Ä¢ ‡§ï‡§æ‡§Æ‡§ï‡§æ‡§ú‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§µ‡•á‡§≥‡•á‡§§ ‡§Ü‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø‡§æ‡§≤‡§æ ‡§≠‡•á‡§ü ‡§¶‡•ç‡§Ø‡§æ
   ‚Ä¢ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§Ö‡§∞‡•ç‡§ú ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§Ü‡§π‡•á ‡§ï‡§æ ‡§§‡•á ‡§§‡§™‡§æ‡§∏‡§æ
   ‚Ä¢ ‡§Ö‡§ß‡§ø‡§ï ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä‡§∏‡§æ‡§†‡•Ä ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§æ: ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§µ‡§ø‡§≠‡§æ‡§ó ‡§™‡§π‡§æ

4Ô∏è‚É£ *‡§Ö‡§∞‡•ç‡§ú ‡§∏‡§æ‡§¶‡§∞ ‡§ï‡§∞‡§æ*
   ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§§‡§™‡§∂‡•Ä‡§≤‡§æ‡§Ç‡§∏‡§π ‡§´‡•â‡§∞‡•ç‡§Æ ‡§™‡•Ç‡§∞‡•ç‡§£‡§™‡§£‡•á ‡§≠‡§∞‡§æ

5Ô∏è‚É£ *‡§™‡§æ‡§†‡§™‡•Å‡§∞‡§æ‡§µ‡§æ ‡§ï‡§∞‡§æ*
   ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§Ö‡§∞‡•ç‡§ú‡§æ‡§ö‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡•Ä ‡§ü‡•ç‡§∞‡•Ö‡§ï ‡§ï‡§∞‡§æ
   ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø‡§æ‡§∂‡•Ä ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§∏‡§æ‡§ß‡§æ

üí° *‡§ü‡•Ä‡§™*: ‡§∏‡§∞‡•ç‡§µ ‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡§æ‡§Ç‡§ö‡•ç‡§Ø‡§æ ‡§´‡•ã‡§ü‡•ã‡§ï‡•â‡§™‡•Ä ‡§†‡•á‡§µ‡§æ` :
                        `üìù *‡§Ø‡•ã‡§ú‡§®‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç*

1Ô∏è‚É£ *‡§™‡§æ‡§§‡•ç‡§∞‡§§‡§æ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç*
   ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∏‡•á ‡§™‡§¢‡§º‡•á‡§Ç ‡§î‡§∞ ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§Ü‡§™ ‡§∏‡§≠‡•Ä ‡§Æ‡§æ‡§®‡§¶‡§Ç‡§°‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç

2Ô∏è‚É£ *‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç*
   ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§á‡§ï‡§ü‡•ç‡§†‡§æ ‡§ï‡§∞‡•á‡§Ç (‡§Ü‡§Æ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§Ü‡§ß‡§æ‡§∞, ‡§Ü‡§Ø ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£ ‡§™‡§§‡•ç‡§∞ ‡§Ü‡§¶‡§ø)

3Ô∏è‚É£ *‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§ú‡§æ‡§è‡§Å ‡§Ø‡§æ ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡§∞‡•á‡§Ç*
   ‚Ä¢ ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ò‡§Ç‡§ü‡•ã‡§Ç ‡§ï‡•á ‡§¶‡•å‡§∞‡§æ‡§® ‡§π‡§Æ‡§æ‡§∞‡•á ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§ú‡§æ‡§è‡§Å
   ‚Ä¢ ‡§Ø‡§æ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§ï‡§ø ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§Ü‡§µ‡•á‡§¶‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç
   ‚Ä¢ ‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç: ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§Ö‡§®‡•Å‡§≠‡§æ‡§ó ‡§¶‡•á‡§ñ‡•á‡§Ç

4Ô∏è‚É£ *‡§Ü‡§µ‡•á‡§¶‡§® ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç*
   ‡§∏‡§π‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§´‡•â‡§∞‡•ç‡§Æ ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§≠‡§∞‡•á‡§Ç

5Ô∏è‚É£ *‡§´‡•â‡§≤‡•ã ‡§Ö‡§™ ‡§ï‡§∞‡•á‡§Ç*
   ‡§Ö‡§™‡§®‡•á ‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ü‡•ç‡§∞‡•à‡§ï ‡§ï‡§∞‡•á‡§Ç
   ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§™‡§°‡§º‡§®‡•á ‡§™‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç

üí° *‡§∏‡•Å‡§ù‡§æ‡§µ*: ‡§∏‡§≠‡•Ä ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º‡•ã‡§Ç ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã‡§ï‡•â‡§™‡•Ä ‡§∞‡§ñ‡•á‡§Ç`;

                await sock.sendMessage(userId, { text: applyGuide });
                await this.showSchemesMenu(sock, userId, lang);
                break;

            default:
                const errorMsg = MESSAGES.invalid_option[lang] + '

                ' + MENUS.schemes[lang].text;
                await sock.sendMessage(userId, { text: errorMsg });
                return;
        }
    }

    // ADD THESE 3 NEW FUNCTIONS AFTER handleSchemesMenu():

    async displaySchemes(sock, userId, schemes, lang, offset) {
        let schemeText = lang === 'en' ? `üèõÔ∏è *Government Schemes* (Showing ${schemes.length} schemes)

` :
            lang === 'mr' ? `üèõÔ∏è *‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ* (${schemes.length} ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¶‡§∞‡•ç‡§∂‡§µ‡§ø‡§§)

` :
                `üèõÔ∏è *‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç* (${schemes.length} ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§¶‡§ø‡§ñ‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç)

`;

        schemes.forEach((scheme, index) => {
            const name = (lang === 'mr' && scheme.name_mr) ? scheme.name_mr : scheme.name;
            const desc = (lang === 'mr' && scheme.description_mr) ? scheme.description_mr : scheme.description;
            const benefits = (lang === 'mr' && scheme.benefits_mr) ? scheme.benefits_mr : scheme.benefits;

            schemeText += `${offset + index + 1}. *${name}*
`;
            if (desc) schemeText += `   ${desc.substring(0, 100)}...
`;
            if (benefits) schemeText += `   üí∞ ${benefits}
`;
            schemeText += `
`;
        });

        await sock.sendMessage(userId, { text: schemeText });
    }

    async handleSchemeSearch(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;
        const searchQuery = input.trim();

        if (searchQuery.length < 2) {
            const tooShort = lang === 'en' ? 'Please enter at least 2 characters to search.' :
                lang === 'mr' ? '‡§ï‡•É‡§™‡§Ø‡§æ ‡§∂‡•ã‡§ß‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ï‡§ø‡§Æ‡§æ‡§® ‡•® ‡§µ‡§∞‡•ç‡§£ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ.' :
                    '‡§ï‡•É‡§™‡§Ø‡§æ ‡§ñ‡•ã‡§ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 2 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§';
            await sock.sendMessage(userId, { text: tooShort });
            return;
        }

        const schemes = await this.store.getSchemes(tenantId, { limit: 10, offset: 0, searchQuery });

        if (!schemes || schemes.length === 0) {
            const noResults = lang === 'en' ? `‚ùå No schemes found for "${searchQuery}"` :
                lang === 'mr' ? `‚ùå "${searchQuery}" ‡§∏‡§æ‡§†‡•Ä ‡§ï‡•ã‡§£‡§§‡•ç‡§Ø‡§æ‡§π‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§∏‡§æ‡§™‡§°‡§≤‡•ç‡§Ø‡§æ ‡§®‡§æ‡§π‡•Ä‡§§` :
                    `‚ùå "${searchQuery}" ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä`;
            await sock.sendMessage(userId, { text: noResults });
        } else {
            const resultsMsg = lang === 'en' ? `üîç *Search Results for "${searchQuery}"*

` :
                lang === 'mr' ? `üîç *"${searchQuery}" ‡§∏‡§æ‡§†‡•Ä ‡§∂‡•ã‡§ß ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ*

` :
                    `üîç *"${searchQuery}" ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ñ‡•ã‡§ú ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ*

`;

            await sock.sendMessage(userId, { text: resultsMsg });
            await this.displaySchemes(sock, userId, schemes, lang, 0);
        }

        session.currentMenu = MENU_STATES.SCHEMES_MENU;
        await this.showSchemesMenu(sock, userId, lang);
    }

    async handleSchemeViewMore(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        if (input.toLowerCase() === 'more' || input === '1') {
            const offset = session.schemeOffset || 10;
            const schemes = await this.store.getSchemes(tenantId, { limit: 10, offset });

            if (!schemes || schemes.length === 0) {
                const noMore = lang === 'en' ? '‚úÖ No more schemes to display.' :
                    lang === 'mr' ? '‚úÖ ‡§¶‡§∞‡•ç‡§∂‡§µ‡§ø‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§Ü‡§£‡§ñ‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§®‡§æ‡§π‡•Ä‡§§.' :
                        '‚úÖ ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§î‡§∞ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§';
                await sock.sendMessage(userId, { text: noMore });
                session.currentMenu = MENU_STATES.SCHEMES_MENU;
                await this.showSchemesMenu(sock, userId, lang);
                return;
            }

            await this.displaySchemes(sock, userId, schemes, lang, offset);

            // Check if there are even more schemes
            const moreSchemes = await this.store.getSchemes(tenantId, { limit: 1, offset: offset + 10 });
            if (moreSchemes && moreSchemes.length > 0) {
                const moreMsg = lang === 'en' ? '
üìÑ Send * MORE * to see more schemes or press 9 for menu' :
                lang === 'mr' ? '
üìÑ ‡§Ö‡§ß‡§ø‡§ï ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§™‡§æ‡§π‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä * MORE * ‡§™‡§æ‡§†‡§µ‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§Æ‡•á‡§®‡•Ç‡§∏‡§æ‡§†‡•Ä 9 ‡§¶‡§æ‡§¨‡§æ' :
                '
üìÑ ‡§Ö‡§ß‡§ø‡§ï ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è * MORE * ‡§≠‡•á‡§ú‡•á‡§Ç ‡§Ø‡§æ ‡§Æ‡•á‡§®‡•Ç ‡§ï‡•á ‡§≤‡§ø‡§è 9 ‡§¶‡§¨‡§æ‡§è‡§Ç';
                await sock.sendMessage(userId, { text: moreMsg });
                session.schemeOffset = offset + 10;
                return; // Stay in SCHEME_VIEW_MORE state
            } else {
                session.currentMenu = MENU_STATES.SCHEMES_MENU;
                await this.showSchemesMenu(sock, userId, lang);
            }
        } else {
            // User entered something else, go back to schemes menu
            session.currentMenu = MENU_STATES.SCHEMES_MENU;
            await this.showSchemesMenu(sock, userId, lang);
        }
    }


    /**
     * Voter Menu
     */
    async showVoterMenu(sock, userId, lang) {
        const session = this.getSession(userId);
        session.currentMenu = MENU_STATES.VOTER_MENU;
        session.previousMenu = MENU_STATES.MAIN_MENU;

        await sock.sendMessage(userId, { text: MENUS.voter[lang].text });
    }

    async handleVoterMenu(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        switch (input) {
            case '1': // Search Voter
                session.currentMenu = 'VOTER_SEARCH_PROMPT';
                const searchMsg = lang === 'en' ? 'üîç *Search Voter*\n\nEnter name, mobile number, or voter ID:' :
                    lang === 'mr' ? 'üîç *‡§Æ‡§§‡§¶‡§æ‡§∞ ‡§∂‡•ã‡§ß‡§æ*\n\n‡§®‡§æ‡§µ, ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§Æ‡§§‡§¶‡§æ‡§∞ ‡§Ü‡§Ø‡§°‡•Ä ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ:' :
                        'üîç *‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ‡§ñ‡•ã‡§ú‡•á‡§Ç*\n\n‡§®‡§æ‡§Æ, ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§Ø‡§æ ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ID ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç:';
                await sock.sendMessage(userId, { text: searchMsg });
                break;

            case '2': // Voter Card Status
            case '3': // Polling Booth
            case '4': // Election Results
                const comingSoon = lang === 'en' ? 'Coming soon!' :
                    lang === 'mr' ? '‡§≤‡§µ‡§ï‡§∞‡§ö ‡§Ø‡•á‡§§ ‡§Ü‡§π‡•á!' : '‡§ú‡§≤‡•ç‡§¶ ‡§Ü ‡§∞‡§π‡§æ ‡§π‡•à!';
                await sock.sendMessage(userId, { text: comingSoon });
                await this.showVoterMenu(sock, userId, lang);
                break;

            default:
                const errorMsg = MESSAGES.invalid_option[lang] + '\n\n' + MENUS.voter[lang].text;
                await sock.sendMessage(userId, { text: errorMsg });
                return;
        }
    }

    async handleVoterSearch(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        // Determine search type
        let searchType = 'name';
        if (/^\d{10}$/.test(input.replace(/\D/g, ''))) {
            searchType = 'mobile';
        } else if (/^[A-Z]{3}\d+/.test(input.toUpperCase())) {
            searchType = 'voter_id';
        }

        const voters = await this.store.searchVoters(tenantId, input, searchType);

        if (!voters || voters.length === 0) {
            const noResults = lang === 'en' ? '‚ùå No voters found. Please try again with a different search term.' :
                lang === 'mr' ? '‚ùå ‡§ï‡•ã‡§£‡§§‡•á‡§π‡•Ä ‡§Æ‡§§‡§¶‡§æ‡§∞ ‡§∏‡§æ‡§™‡§°‡§≤‡•á ‡§®‡§æ‡§π‡•Ä‡§§. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡•á‡§ó‡§≥‡•ç‡§Ø‡§æ ‡§∂‡•ã‡§ß ‡§∂‡§¨‡•ç‡§¶‡§æ‡§∏‡§π ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ.' :
                    '‚ùå ‡§ï‡•ã‡§à ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§ø‡§∏‡•Ä ‡§Ö‡§®‡•ç‡§Ø ‡§ñ‡•ã‡§ú ‡§∂‡§¨‡•ç‡§¶ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§';
            await sock.sendMessage(userId, { text: noResults });
            session.currentMenu = MENU_STATES.VOTER_MENU;
            await this.showVoterMenu(sock, userId, lang);
            return;
        }

        // Format and send results
        let resultText = lang === 'en' ? `‚úÖ *Found ${voters.length} voter(s)*\n\n` :
            lang === 'mr' ? `‚úÖ *${voters.length} ‡§Æ‡§§‡§¶‡§æ‡§∞ ‡§∏‡§æ‡§™‡§°‡§≤‡•á*\n\n` :
                `‚úÖ *${voters.length} ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ‡§Æ‡§ø‡§≤‡•á*\n\n`;

        voters.forEach((voter, index) => {
            const name = lang === 'mr' ? (voter.name_marathi || voter.name_english) : voter.name_english;
            const cardNum = voter.card_number || 'N/A';
            const age = voter.age || 'N/A';
            const booth = voter.polling_booth_name || 'N/A';
            const ward = voter.ward || 'N/A';

            resultText += lang === 'en' ?
                `${index + 1}. *${name}*\n   Card: ${cardNum}\n   Age: ${age}, Ward: ${ward}\n   Booth: ${booth}\n\n` :
                lang === 'mr' ?
                    `${index + 1}. *${name}*\n   ‡§ï‡§æ‡§∞‡•ç‡§°: ${cardNum}\n   ‡§µ‡§Ø: ${age}, ‡§™‡•ç‡§∞‡§≠‡§æ‡§ó: ${ward}\n   ‡§¨‡•Ç‡§•: ${booth}\n\n` :
                    `${index + 1}. *${name}*\n   ‡§ï‡§æ‡§∞‡•ç‡§°: ${cardNum}\n   ‡§â‡§Æ‡•ç‡§∞: ${age}, ‡§µ‡§æ‡§∞‡•ç‡§°: ${ward}\n   ‡§¨‡•Ç‡§•: ${booth}\n\n`;
        });

        await sock.sendMessage(userId, { text: resultText });

        // Return to menu
        session.currentMenu = MENU_STATES.VOTER_MENU;
        await this.showVoterMenu(sock, userId, lang);
    }

    /**
     * Events Menu
     */
    async showEventsMenu(sock, userId, lang) {
        const session = this.getSession(userId);
        session.currentMenu = MENU_STATES.EVENTS_MENU;
        session.previousMenu = MENU_STATES.MAIN_MENU;

        await sock.sendMessage(userId, { text: MENUS.events[lang].text });
    }

    async handleEventsMenu(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        let filter = 'upcoming';
        if (input === '1') filter = 'upcoming';
        else if (input === '2') filter = 'today';
        else if (input === '3') filter = 'past';
        else if (input === '4') {
            const comingSoon = lang === 'en' ? 'Event gallery coming soon!' :
                lang === 'mr' ? '‡§á‡§µ‡•ç‡§π‡•á‡§Ç‡§ü ‡§ó‡•Ö‡§≤‡§∞‡•Ä ‡§≤‡§µ‡§ï‡§∞‡§ö!' : '‡§á‡§µ‡•á‡§Ç‡§ü ‡§ó‡•à‡§≤‡§∞‡•Ä ‡§ú‡§≤‡•ç‡§¶!';
            await sock.sendMessage(userId, { text: comingSoon });
            await this.showEventsMenu(sock, userId, lang);
            return;
        } else {
            const errorMsg = MESSAGES.invalid_option[lang] + '\n\n' + MENUS.events[lang].text;
            await sock.sendMessage(userId, { text: errorMsg });
            return;
        }

        const events = await this.store.getEvents(tenantId, filter);

        if (!events || events.length === 0) {
            const noEvents = lang === 'en' ? `No ${filter} events found.` :
                lang === 'mr' ? '‡§ï‡•ã‡§£‡§§‡•á‡§π‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§∏‡§æ‡§™‡§°‡§≤‡•á ‡§®‡§æ‡§π‡•Ä‡§§.' : '‡§ï‡•ã‡§à ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•á‡•§';
            await sock.sendMessage(userId, { text: noEvents });
        } else {
            let eventText = lang === 'en' ? `üéâ *${filter.toUpperCase()} Events* (${events.length})\n\n` :
                lang === 'mr' ? `üéâ *‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ* (${events.length})\n\n` :
                    `üéâ *‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ* (${events.length})\n\n`;

            events.forEach((event, index) => {
                const title = event.title || 'Untitled';
                const date = new Date(event.date).toLocaleDateString(lang === 'mr' ? 'mr-IN' : lang === 'hi' ? 'hi-IN' : 'en-IN');
                const location = event.location || 'TBA';
                eventText += `${index + 1}. *${title}*\n   üìÖ ${date}\n   üìç ${location}\n\n`;
            });

            await sock.sendMessage(userId, { text: eventText });
        }

        await this.showEventsMenu(sock, userId, lang);
    }

    /**
     * Works Menu
     */
    async showWorksMenu(sock, userId, lang) {
        const session = this.getSession(userId);
        session.currentMenu = MENU_STATES.WORKS_MENU;
        session.previousMenu = MENU_STATES.MAIN_MENU;

        await sock.sendMessage(userId, { text: MENUS.works[lang].text });
    }

    async handleWorksMenu(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        let status = 'all';
        if (input === '1') status = 'In Progress';
        else if (input === '2') status = 'Completed';
        else if (input === '3') status = 'Planned';
        else if (input === '4') {
            // Show improvements
            const improvements = await this.store.getImprovements(tenantId);
            if (!improvements || improvements.length === 0) {
                const noData = lang === 'en' ? 'No improvements found.' :
                    lang === 'mr' ? '‡§ï‡•ã‡§£‡§§‡•á‡§π‡•Ä ‡§∏‡•Å‡§ß‡§æ‡§∞‡§£‡§æ ‡§∏‡§æ‡§™‡§°‡§≤‡•ç‡§Ø‡§æ ‡§®‡§æ‡§π‡•Ä‡§§.' : '‡§ï‡•ã‡§à ‡§∏‡•Å‡§ß‡§æ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§';
                await sock.sendMessage(userId, { text: noData });
            } else {
                let impText = lang === 'en' ? `üèóÔ∏è *Improvements* (${improvements.length})\n\n` :
                    lang === 'mr' ? `üèóÔ∏è *‡§∏‡•Å‡§ß‡§æ‡§∞‡§£‡§æ* (${improvements.length})\n\n` :
                        `üèóÔ∏è *‡§∏‡•Å‡§ß‡§æ‡§∞* (${improvements.length})\n\n`;

                improvements.forEach((imp, index) => {
                    const title = imp.title || 'Untitled';
                    const desc = imp.description?.substring(0, 80) || '';
                    impText += `${index + 1}. *${title}*\n   ${desc}...\n\n`;
                });

                await sock.sendMessage(userId, { text: impText });
            }
            await this.showWorksMenu(sock, userId, lang);
            return;
        } else {
            const errorMsg = MESSAGES.invalid_option[lang] + '\n\n' + MENUS.works[lang].text;
            await sock.sendMessage(userId, { text: errorMsg });
            return;
        }

        const works = await this.store.getWorks(tenantId, status);

        if (!works || works.length === 0) {
            const noWorks = lang === 'en' ? `No ${status} works found.` :
                lang === 'mr' ? '‡§ï‡•ã‡§£‡§§‡•Ä‡§π‡•Ä ‡§ï‡§æ‡§Æ‡•á ‡§∏‡§æ‡§™‡§°‡§≤‡•Ä ‡§®‡§æ‡§π‡•Ä‡§§.' : '‡§ï‡•ã‡§à ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§';
            await sock.sendMessage(userId, { text: noWorks });
        } else {
            let worksText = lang === 'en' ? `üèóÔ∏è *Development Works* (${works.length})\n\n` :
                lang === 'mr' ? `üèóÔ∏è *‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§ï‡§æ‡§Æ‡•á* (${works.length})\n\n` :
                    `üèóÔ∏è *‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§Ø* (${works.length})\n\n`;

            works.forEach((work, index) => {
                const title = work.title || 'Untitled';
                const status = work.status || 'Unknown';
                const budget = work.budget || 'N/A';
                worksText += `${index + 1}. *${title}*\n   Status: ${status}\n   Budget: ‚Çπ${budget}\n\n`;
            });

            await sock.sendMessage(userId, { text: worksText });
        }

        await this.showWorksMenu(sock, userId, lang);
    }

    /**
     * Ward Problems Menu
     */
    async showWardProblemsMenu(sock, userId, lang) {
        const session = this.getSession(userId);
        session.currentMenu = MENU_STATES.WARD_PROBLEMS_MENU;
        session.previousMenu = MENU_STATES.MAIN_MENU;

        await sock.sendMessage(userId, { text: MENUS.ward_problems[lang].text });
    }

    async handleWardProblemsMenu(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        switch (input) {
            case '1': // Report New Problem
                const msg = lang === 'en' ? 'üìù *Report Ward Problem*\n\nThis feature allows you to report civic issues in your ward.\n\nUse the "Submit Complaint" menu (Option 1 from Main Menu) to report problems.' :
                    lang === 'mr' ? 'üìù *‡§™‡•ç‡§∞‡§≠‡§æ‡§ó ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§®‡•ã‡§Ç‡§¶‡§µ‡§æ*\n\n‡§π‡•á ‡§µ‡•à‡§∂‡§ø‡§∑‡•ç‡§ü‡•ç‡§Ø ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§™‡•ç‡§∞‡§≠‡§æ‡§ó‡§æ‡§§‡•Ä‡§≤ ‡§®‡§æ‡§ó‡§∞‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§®‡•ã‡§Ç‡§¶‡§µ‡§ø‡§£‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§™‡§∞‡§µ‡§æ‡§®‡§ó‡•Ä ‡§¶‡•á‡§§‡•á.\n\n‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§®‡•ã‡§Ç‡§¶‡§µ‡§ø‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä "‡§§‡§ï‡•ç‡§∞‡§æ‡§∞ ‡§®‡•ã‡§Ç‡§¶‡§µ‡§æ" ‡§Æ‡•á‡§®‡•Ç (‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•á‡§®‡•Ç‡§Æ‡§ß‡•Ç‡§® ‡§™‡§∞‡•ç‡§Ø‡§æ‡§Ø 1) ‡§µ‡§æ‡§™‡§∞‡§æ.' :
                        'üìù *‡§µ‡§æ‡§∞‡•ç‡§° ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç*\n\n‡§Ø‡§π ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ ‡§Ü‡§™‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§µ‡§æ‡§∞‡•ç‡§° ‡§Æ‡•á‡§Ç ‡§®‡§æ‡§ó‡§∞‡§ø‡§ï ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§π‡•à‡•§\n\n‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è "‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" ‡§Æ‡•á‡§®‡•Ç (‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•á‡§®‡•Ç ‡§∏‡•á ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ 1) ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§';
                await sock.sendMessage(userId, { text: msg });
                break;

            case '2': // View Ward Issues
            case '3': // Track Problem Status  
            case '4': // Solved Problems
                const comingSoon = lang === 'en' ? 'Coming soon!' :
                    lang === 'mr' ? '‡§≤‡§µ‡§ï‡§∞‡§ö ‡§Ø‡•á‡§§ ‡§Ü‡§π‡•á!' : '‡§ú‡§≤‡•ç‡§¶ ‡§Ü ‡§∞‡§π‡§æ ‡§π‡•à!';
                await sock.sendMessage(userId, { text: comingSoon });
                break;

            default:
                const errorMsg = MESSAGES.invalid_option[lang] + '\n\n' + MENUS.ward_problems[lang].text;
                await sock.sendMessage(userId, { text: errorMsg });
        }

        await this.showWardProblemsMenu(sock, userId, lang);
    }

    /**
     * Contact Menu
     */
    async showContactMenu(sock, userId, lang) {
        const session = this.getSession(userId);
        session.currentMenu = MENU_STATES.CONTACT_MENU;
        session.previousMenu = MENU_STATES.MAIN_MENU;

        await sock.sendMessage(userId, { text: MENUS.contact[lang].text });
    }

    async handleContactMenu(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        let contactText = '';

        switch (input) {
            case '1': // Office Address
                contactText = lang === 'en' ? 'üè¢ *Office Address*\n\nNagarsevak Office\nWard No. 12\nPune, Maharashtra' :
                    lang === 'mr' ? 'üè¢ *‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§™‡§§‡•ç‡§§‡§æ*\n\n‡§®‡§ó‡§∞‡§∏‡•á‡§µ‡§ï ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø\n‡§™‡•ç‡§∞‡§≠‡§æ‡§ó ‡§ï‡•ç‡§∞. 12\n‡§™‡•Å‡§£‡•á, ‡§Æ‡§π‡§æ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞' :
                        'üè¢ *‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§™‡§§‡§æ*\n\n‡§®‡§ó‡§∞‡§∏‡•á‡§µ‡§ï ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø\n‡§µ‡§æ‡§∞‡•ç‡§° ‡§®‡§Ç. 12\n‡§™‡•Å‡§£‡•á, ‡§Æ‡§π‡§æ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞';
                break;
            case '2': // Office Hours
                contactText = lang === 'en' ? '‚è∞ *Office Hours*\n\nMonday - Friday: 10:00 AM - 5:00 PM\nSaturday: 10:00 AM - 2:00 PM\nSunday: Closed' :
                    lang === 'mr' ? '‚è∞ *‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§µ‡•á‡§≥*\n\n‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞ - ‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞: ‡§∏‡§ï‡§æ‡§≥‡•Ä 10:00 - ‡§∏‡§Ç‡§ß‡•ç‡§Ø‡§æ‡§ï‡§æ‡§≥‡•Ä 5:00\n‡§∂‡§®‡§ø‡§µ‡§æ‡§∞: ‡§∏‡§ï‡§æ‡§≥‡•Ä 10:00 - ‡§¶‡•Å‡§™‡§æ‡§∞‡•Ä 2:00\n‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞: ‡§¨‡§Ç‡§¶' :
                        '‚è∞ *‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§∏‡§Æ‡§Ø*\n\n‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞ - ‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞: ‡§∏‡•Å‡§¨‡§π 10:00 - ‡§∂‡§æ‡§Æ 5:00\n‡§∂‡§®‡§ø‡§µ‡§æ‡§∞: ‡§∏‡•Å‡§¨‡§π 10:00 - ‡§¶‡•ã‡§™‡§π‡§∞ 2:00\n‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞: ‡§¨‡§Ç‡§¶';
                break;
            case '3': // Phone Numbers
                contactText = lang === 'en' ? 'üìû *Contact Numbers*\n\nOffice: +91 020 1234 5678\nMobile: +91 98765 43210' :
                    lang === 'mr' ? 'üìû *‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï*\n\n‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø: +91 020 1234 5678\n‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤: +91 98765 43210' :
                        'üìû *‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç‡§¨‡§∞*\n\n‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø: +91 020 1234 5678\n‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤: +91 98765 43210';
                break;
            case '4': // Email
                contactText = lang === 'en' ? 'üìß *Email Address*\n\nofficial@nagarsevak.com' :
                    lang === 'mr' ? 'üìß *‡§à‡§Æ‡•á‡§≤ ‡§™‡§§‡•ç‡§§‡§æ*\n\nofficial@nagarsevak.com' :
                        'üìß *‡§à‡§Æ‡•á‡§≤ ‡§™‡§§‡§æ*\n\nofficial@nagarsevak.com';
                break;
            case '5': // Social Media
                contactText = lang === 'en' ? 'üì± *Follow Us*\n\nFacebook: /NagarsevakWard12\nTwitter: @NagarsevakW12\nInstagram: @nagarsevak_w12' :
                    lang === 'mr' ? 'üì± *‡§Ü‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§´‡•â‡§≤‡•ã ‡§ï‡§∞‡§æ*\n\nFacebook: /NagarsevakWard12\nTwitter: @NagarsevakW12\nInstagram: @nagarsevak_w12' :
                        'üì± *‡§π‡§Æ‡•á‡§Ç ‡§´‡•â‡§≤‡•ã ‡§ï‡§∞‡•á‡§Ç*\n\nFacebook: /NagarsevakWard12\nTwitter: @NagarsevakW12\nInstagram: @nagarsevak_w12';
                break;
            default:
                const errorMsg = MESSAGES.invalid_option[lang] + '\n\n' + MENUS.contact[lang].text;
                await sock.sendMessage(userId, { text: errorMsg });
                return;
        }

        await sock.sendMessage(userId, { text: contactText });
        await this.showContactMenu(sock, userId, lang);
    }

    /**
     * Other Services Menu
     */
    async showOtherMenu(sock, userId, lang) {
        const session = this.getSession(userId);
        session.currentMenu = MENU_STATES.OTHER_MENU;
        session.previousMenu = MENU_STATES.MAIN_MENU;

        await sock.sendMessage(userId, { text: MENUS.other[lang].text });
    }

    async handleOtherMenu(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        let response = '';

        switch (input) {
            case '1': // Letters/Documents
                response = lang === 'en' ? 'üìÑ *Letters & Documents*\n\nFor official letters and documents, please visit our office during working hours or check the website.' :
                    lang === 'mr' ? 'üìÑ *‡§™‡§§‡•ç‡§∞‡•á/‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡•á*\n\n‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§™‡§§‡•ç‡§∞‡•á ‡§Ü‡§£‡§ø ‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä, ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§æ‡§Æ‡§ï‡§æ‡§ú‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§µ‡•á‡§≥‡•á‡§§ ‡§Ü‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø‡§æ‡§§ ‡§≠‡•á‡§ü ‡§¶‡•ç‡§Ø‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§§‡§™‡§æ‡§∏‡§æ.' :
                        'üìÑ *‡§™‡§§‡•ç‡§∞/‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º*\n\n‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§™‡§§‡•ç‡§∞‡•ã‡§Ç ‡§î‡§∞ ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§∏‡§Æ‡§Ø ‡§ï‡•á ‡§¶‡•å‡§∞‡§æ‡§® ‡§π‡§Æ‡§æ‡§∞‡•á ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§è‡§Ç ‡§Ø‡§æ ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§';
                break;
            case '2': // Meeting Diary
                response = lang === 'en' ? 'üìÖ *Meeting Diary*\n\nUpcoming meetings and minutes are available on the website.' :
                    lang === 'mr' ? 'üìÖ *‡§Æ‡•Ä‡§ü‡§ø‡§Ç‡§ó ‡§°‡§æ‡§Ø‡§∞‡•Ä*\n\n‡§Ü‡§ó‡§æ‡§Æ‡•Ä ‡§∏‡§≠‡§æ ‡§Ü‡§£‡§ø ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§µ‡•É‡§§‡•ç‡§§ ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü‡§µ‡§∞ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§Ü‡§π‡•á‡§§.' :
                        'üìÖ *‡§Æ‡•Ä‡§ü‡§ø‡§Ç‡§ó ‡§°‡§æ‡§Ø‡§∞‡•Ä*\n\n‡§Ü‡§ó‡§æ‡§Æ‡•Ä ‡§¨‡•à‡§†‡§ï‡•á‡§Ç ‡§î‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§µ‡•É‡§§‡•ç‡§§ ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§™‡§∞ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à‡§Ç‡•§';
                break;
            case '3': // Photo Gallery
                response = lang === 'en' ? 'üì∏ *Photo Gallery*\n\nView photos of events and development works on our website.' :
                    lang === 'mr' ? 'üì∏ *‡§´‡•ã‡§ü‡•ã ‡§ó‡•Ö‡§≤‡§∞‡•Ä*\n\n‡§Ü‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü‡§µ‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§Ü‡§£‡§ø ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§Ç‡§ö‡•á ‡§´‡•ã‡§ü‡•ã ‡§™‡§π‡§æ.' :
                        'üì∏ *‡§´‡•ã‡§ü‡•ã ‡§ó‡•à‡§≤‡§∞‡•Ä*\n\n‡§π‡§Æ‡§æ‡§∞‡•Ä ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§™‡§∞ ‡§Ü‡§Ø‡•ã‡§ú‡§®‡•ã‡§Ç ‡§î‡§∞ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞‡•á‡§Ç ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§';
                break;
            case '4': // Newspaper Clippings
                response = lang === 'en' ? 'üì∞ *Newspaper Clippings*\n\nLatest news coverage is available on the website.' :
                    lang === 'mr' ? 'üì∞ *‡§µ‡•É‡§§‡•ç‡§§‡§™‡§§‡•ç‡§∞ ‡§ï‡§æ‡§§‡•ç‡§∞‡§£‡•á*\n\n‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§¨‡§æ‡§§‡§Æ‡•ç‡§Ø‡§æ‡§Ç‡§ö‡§æ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü‡§µ‡§∞ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§Ü‡§π‡•á.' :
                        'üì∞ *‡§Ö‡§ñ‡§¨‡§æ‡§∞ ‡§ï‡•Ä ‡§ï‡§§‡§∞‡§®‡•á‡§Ç*\n\n‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞ ‡§ï‡§µ‡§∞‡•á‡§ú ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§™‡§∞ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à‡•§';
                break;
            case '5': // Ward Budget Info
                response = lang === 'en' ? 'üí∞ *Ward Budget Information*\n\nDetailed budget allocation and spending reports are available on the website.' :
                    lang === 'mr' ? 'üí∞ *‡§™‡•ç‡§∞‡§≠‡§æ‡§ó ‡§Ö‡§∞‡•ç‡§•‡§∏‡§Ç‡§ï‡§≤‡•ç‡§™*\n\n‡§§‡§™‡§∂‡•Ä‡§≤‡§µ‡§æ‡§∞ ‡§Ö‡§∞‡•ç‡§•‡§∏‡§Ç‡§ï‡§≤‡•ç‡§™ ‡§µ‡§æ‡§ü‡§™ ‡§Ü‡§£‡§ø ‡§ñ‡§∞‡•ç‡§ö ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü‡§µ‡§∞ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§Ü‡§π‡•á‡§§.' :
                        'üí∞ *‡§µ‡§æ‡§∞‡•ç‡§° ‡§¨‡§ú‡§ü ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä*\n\n‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§¨‡§ú‡§ü ‡§Ü‡§µ‡§Ç‡§ü‡§® ‡§î‡§∞ ‡§ñ‡§∞‡•ç‡§ö ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§™‡§∞ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à‡§Ç‡•§';
                break;
            default:
                const errorMsg = MESSAGES.invalid_option[lang] + '\n\n' + MENUS.other[lang].text;
                await sock.sendMessage(userId, { text: errorMsg });
                return;
        }

        await sock.sendMessage(userId, { text: response });
        await this.showOtherMenu(sock, userId, lang);
    }
}

module.exports = MenuNavigator;
