// Area Problem Form Handlers - Add before the "Other Services Menu" section

    /**
     * Area Problem Report Form Handlers
     */
    async handleAreaProblemTitle(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        session.areaFormData.title = input.trim();
        session.currentMenu = MENU_STATES.AREA_PROBLEM_FORM_DESCRIPTION;

        const descPrompt = lang === 'en' ? 'ЁЯУД Please describe the problem in detail:' :
            lang === 'mr' ? 'ЁЯУД рдХреГрдкрдпрд╛ рд╕рдорд╕реНрдпрд╛рдЪреЗ рддрдкрд╢реАрд▓рд╡рд╛рд░ рд╡рд░реНрдгрди рдХрд░рд╛:' :
                'ЁЯУД рдХреГрдкрдпрд╛ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд░реНрдгрди рдХрд░реЗрдВ:';
        await sock.sendMessage(userId, { text: descPrompt });
    }

    async handleAreaProblemDescription(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        session.areaFormData.description = input.trim();
        session.currentMenu = MENU_STATES.AREA_PROBLEM_FORM_LOCATION;

        const locPrompt = lang === 'en' ? 'ЁЯУН Where is this problem located?\n\n_Example: Near bus stand, Main road, etc._' :
            lang === 'mr' ? 'ЁЯУН рд╣реА рд╕рдорд╕реНрдпрд╛ рдХреБрдареЗ рдЖрд╣реЗ?\n\n_рдЙрджрд╛рд╣рд░рдг: рдмрд╕ рд╕реНрдерд╛рдирдХрд╛рдЬрд╡рд│, рдореБрдЦреНрдп рд░рд╕реНрддрд╛, рдЗ._' :
                'ЁЯУН рдпрд╣ рд╕рдорд╕реНрдпрд╛ рдХрд╣рд╛рдБ рд╣реИ?\n\n_рдЙрджрд╛рд╣рд░рдг: рдмрд╕ рд╕реНрдЯреИрдВрдб рдХреЗ рдкрд╛рд╕, рдореБрдЦреНрдп рд╕рдбрд╝рдХ, рдЖрджрд┐ред_';
        await sock.sendMessage(userId, { text: locPrompt });
    }

    async handleAreaProblemLocation(sock, tenantId, userId, input) {
        const session = this.getSession(userId);
        const lang = session.language;

        session.areaFormData.location = input.trim();

        // Submit the area problem
        try {
            const problemData = {
                tenant_id: tenantId,
                user_id: userId.replace('@s.whatsapp.net', ''),
                title: session.areaFormData.title,
                description: session.areaFormData.description,
                location: session.areaFormData.location,
                status: 'Pending'
            };

            const result = await this.store.reportAreaProblem(problemData);

            if (result) {
                const successMsg = lang === 'en' ? `тЬЕ *Area Problem Reported!*\n\nTitle: ${session.areaFormData.title}\nLocation: ${session.areaFormData.location}\n\nYour report has been submitted and will be reviewed by the office. Thank you for helping improve our ward!` :
                    lang === 'mr' ? `тЬЕ *рдХреНрд╖реЗрддреНрд░ рд╕рдорд╕реНрдпрд╛ рдиреЛрдВрджрд╡рд┐рд▓реА!*\n\nрд╢реАрд░реНрд╖рдХ: ${session.areaFormData.title}\nрд╕реНрдерд╛рди: ${session.areaFormData.location}\n\nрддреБрдордЪрд╛ рдЕрд╣рд╡рд╛рд▓ рд╕рд╛рджрд░ рдХрд░рдгреНрдпрд╛рдд рдЖрд▓рд╛ рдЖрд╣реЗ рдЖрдгрд┐ рдХрд╛рд░реНрдпрд╛рд▓рдпрд╛рджреНрд╡рд╛рд░реЗ рддреНрдпрд╛рдЪреЗ рдкреБрдирд░рд╛рд╡рд▓реЛрдХрди рдХреЗрд▓реЗ рдЬрд╛рдИрд▓. рдЖрдордЪреНрдпрд╛ рдкреНрд░рднрд╛рдЧрд╛рд▓рд╛ рд╕реБрдзрд╛рд░рдгреНрдпрд╛рдд рдорджрдд рдХреЗрд▓реНрдпрд╛рдмрджреНрджрд▓ рдзрдиреНрдпрд╡рд╛рдж!` :
                        `тЬЕ *рдХреНрд╖реЗрддреНрд░ рд╕рдорд╕реНрдпрд╛ рд░рд┐рдкреЛрд░реНрдЯ рдХреА рдЧрдИ!*\n\nрд╢реАрд░реНрд╖рдХ: ${session.areaFormData.title}\nрд╕реНрдерд╛рди: ${session.areaFormData.location}\n\nрдЖрдкрдХреА рд░рд┐рдкреЛрд░реНрдЯ рдЬрдорд╛ рдХрд░ рджреА рдЧрдИ рд╣реИ рдФрд░ рдХрд╛рд░реНрдпрд╛рд▓рдп рджреНрд╡рд╛рд░рд╛ рдЗрд╕рдХреА рд╕рдореАрдХреНрд╖рд╛ рдХреА рдЬрд╛рдПрдЧреАред рд╣рдорд╛рд░реЗ рд╡рд╛рд░реНрдб рдХреЛ рдмреЗрд╣рддрд░ рдмрдирд╛рдиреЗ рдореЗрдВ рдорджрдж рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж!`;
                await sock.sendMessage(userId, { text: successMsg });
            }

            // Clear form data
            delete session.areaFormData;

            // Return to main menu
            await this.showMainMenu(sock, userId, lang);

        } catch (error) {
            console.error('Error reporting area problem:', error);
            const errorMsg = lang === 'en' ? 'тЭМ Failed to submit report. Please try again later.' :
                lang === 'mr' ? 'тЭМ рдЕрд╣рд╡рд╛рд▓ рд╕рд╛рджрд░ рдХрд░рдгреНрдпрд╛рдд рдЕрдпрд╢рд╕реНрд╡реА. рдХреГрдкрдпрд╛ рдкреБрдиреНрд╣рд╛ рдкреНрд░рдпрддреНрди рдХрд░рд╛.' :
                    'тЭМ рд░рд┐рдкреЛрд░реНрдЯ рдЬрдорд╛ рдХрд░рдиреЗ рдореЗрдВ рд╡рд┐рдлрд▓ред рдХреГрдкрдпрд╛ рдмрд╛рдж рдореЗрдВ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред';
            await sock.sendMessage(userId, { text: errorMsg });
            await this.showMainMenu(sock, userId, lang);
        }
    }
